<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <h:outputStylesheet library="css" name="style.css"/>
</h:head>
<h:body>
    <p:growl id="growl" showDetail="true" />
    <table style="width: 100%;">
        <tr>
            <td>
                <h:outputText style="font-weight: bold; font-size: 20px;" value="#{Controller.objectPath}" />
            </td>
            <td width="120" align="center">
                <h:form id="test">
                    <h:outputText value="#{Controller.test}"/>
                    <p:commandButton value="Сохранить" >
                        <f:ajax listener="#{Controller.saveData}" render="test :tableForm"/>
                    </p:commandButton>

                </h:form>
            </td>
        </tr>
    </table>

            <h:form id="tableForm" style="height: 100%;">
                <p:calendar >
                    <p:ajax event="dateSelect"
                            listener="#{Controller.saveData}" update=":tableForm"/>
                </p:calendar>
                <p:dataTable id="tableData" var="data" value="#{Controller.tableModel}" rowHover="true" scrollable="true" scrollHeight="100%"
                             editable="true" editMode="cell" rowIndexVar="rowIdx" rowStyleClass="#{data.color}" rowKey="#{data.id}"
                             filteredValue="#{Controller.filteredTableModel}" widgetVar="tableWidget">

                    <p:ajax event="cellEditInit" listener="#{Controller.onCellEditInit}" />
                    <p:ajax event="cellEdit" listener="#{Controller.onCellEdit}" update=":growl" />

                    <p:columnGroup type="header">
                        <p:row>
                            <p:column rowspan="2" headerText="Обозн" width="50"/>
                            <p:column rowspan="2" headerText="Стат.агр." width="150"/>
                            <p:column rowspan="2" headerText="Зона" width="50"/>
                            <p:column rowspan="2" headerText="Техпр" width="50" filterBy="#{data.techProcCode}" filterMatchMode="exact">
                                <f:facet name="filter">
                                    <p:selectOneMenu onchange="PF('tableWidget').filter()" style="width: 50px;">
                                        <f:selectItem itemLabel="-" itemValue="#{null}" noSelectionOption="true" />
                                        <f:selectItems value="#{Controller.techProcFilter}" />
                                    </p:selectOneMenu>
                                </f:facet>
                            </p:column>
                            <p:column rowspan="2" headerText="Ед.изм" width="50"/>
                            <p:column rowspan="2" headerText="График/Опт.знач." width="150"/>
                            <p:column rowspan="2" headerText="Суточное снижение" width="150"/>
                            <p:column colspan="3" headerText="Технологические границы" width="185" />
                            <p:column colspan="4" headerText="Аварийные границы" width="215" />
                        </p:row>
                        <p:row>
                            <p:column headerText="Нижняя" width="80" />
                            <p:column headerText="Верхняя" width="80" />
                            <p:column headerText="%" width="25" />
                            <p:column headerText="Нижняя" width="80" />
                            <p:column headerText="Верхняя" width="80" />
                            <p:column headerText="%" width="25" />
                            <p:column headerText="Отн" width="35" />
                        </p:row>
                    </p:columnGroup>

                    <p:column>
                        <h:outputText id="parMemo" value="#{data.parMemo}" />
                        <p:tooltip for="parMemo" value="#{data.parName}" position="bottom"/>
                    </p:column>

                    <p:column style="white-space: nowrap; text-overflow: ellipsis; max-width: 50px;">
                        <h:outputText id="statAgrName" value="#{data.statAgrName}" />
                        <p:tooltip for="statAgrName" value="#{data.statAgrName}" position="bottom"/>
                    </p:column>

                    <p:column styleClass="centre-column">
                        <h:outputText value="#{data.zone}"/>
                    </p:column>

                    <p:column styleClass="centre-column">
                        <h:outputText value="#{data.techProcCode}"/>
                    </p:column>

                    <p:column styleClass="centre-column">
                        <h:outputText value="#{data.measureName}"/>
                    </p:column>

                    <p:column id="graphColumn" styleClass="#{data.graphColor}"
                              style="white-space: nowrap; text-overflow: ellipsis; max-width: 50px;">
                        <p:cellEditor disabled="#{data.graphDisable}">
                            <f:facet name="output">
                                <h:outputText id="graphValue" value="#{data.graphName}"/>
                            </f:facet>
                            <f:facet name="input">
                                <h:outputText value="#{data.graphName}"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column id="decreaseColumn" styleClass="#{data.decreaseColor}">
                        <!--                        TODO Попробовать заменить на commandLink-->
                        <p:cellEditor disabled="#{data.decreaseDisable}">
                            <f:facet name="output">
                                <h:outputText id="decreaseValue" value="#{data.decreaseName}"/>
                            </f:facet>
                            <f:facet name="input">
                                <h:outputText value="#{data.decreaseName}"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column styleClass="centre-column #{data.tMinColor}">
                        <p:cellEditor disabled="#{data.tMinDisable}">
                            <f:facet name="output">
                                <h:outputText value="#{data.tMin}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{data.tMin}" style="max-width: 60px;" />
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column styleClass="centre-column #{data.tMaxColor}">
                        <p:cellEditor disabled="#{data.tMaxDisable}">
                            <f:facet name="output">
                                <h:outputText value="#{data.tMax}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{data.tMax}" style="max-width: 60px;" />
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column styleClass="centre-column">
                        <p:selectBooleanCheckbox disabled="#{data.tPersentDisable}" value="#{data.tPercent}">
                            <p:ajax event="change" listener="#{Controller.onBooleanValueChange(data)}" />
                        </p:selectBooleanCheckbox>
                    </p:column>

                    <p:column styleClass="centre-column #{data.aMinColor}">
                        <p:cellEditor disabled="#{data.aMinDisable}">
                            <f:facet name="output">
                                <h:outputText value="#{data.aMin}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{data.aMin}" style="max-width: 60px;" />
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column styleClass="centre-column #{data.aMaxColor}">
                        <p:cellEditor disabled="#{data.aMaxDisable}">
                            <f:facet name="output">
                                <h:outputText value="#{data.aMax}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{data.aMax}" style="max-width: 60px;" />
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column styleClass="centre-column">
                        <p:selectBooleanCheckbox disabled="#{data.aPersentDisable}" id="aPercentColumn" value="#{data.aPercent}">

                        </p:selectBooleanCheckbox>
                    </p:column>

                    <p:column styleClass="centre-column">
                        <p:selectBooleanCheckbox disabled="#{data.aPersentDisable}" id="absoluteColumn" value="#{data.absolute}">

                        </p:selectBooleanCheckbox>
                    </p:column>
                </p:dataTable>
            </h:form>
</h:body>
</html>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">
    <h:form>
        <p:remoteCommand name="showRowEdit" oncomplete="switchToRowEdit('groundTempTableWidget', 0);"/>
    </h:form>

    <h:form id="groundTempForm" style="height: 100%;">
        <div style="height: calc(100% - 109px);">
            <p:panel styleClass="tc-panel" header="Температура грунта" style="padding-bottom: 5px;">
                <div style="height: calc(100% - 6px); padding: 3px 0 3px 3px;">
                    <p:dataTable id="groundTempTable" var="groundTempData" value="#{groundTempMB.groundTemps}"
                                 scrollable="true" scrollHeight="100%" emptyMessage="#{global['table.empty.value']}"
                                 editable="#{systemParamsUtil.write}" widgetVar="groundTempTableWidget">

                        <p:ajax event="rowEdit" listener="#{groundTempMB.onRowEdit}"
                                onstart="PF('statusDialog').show();" onsuccess="PF('statusDialog').hide();"
                                update="growl" oncomplete="PF('groundTempTableWidget').filter();" />
                        <p:ajax event="rowEditCancel" listener="#{groundTempMB.onRowEditCancel}"
                                oncomplete="PF('groundTempTableWidget').filter();"/>

                        <p:column headerText="Дата" style="text-align: center;">
                            <p:cellEditor disabled="#{!groundTempData.editable}">
                                <f:facet name="output">
                                    <h:outputText style="display: block;" value="#{groundTempData.stringDate}" />
                                </f:facet>
                                <f:facet name="input">
                                    <p:datePicker value="#{groundTempData.date}" view="month" pattern="MM.yyyy"/>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column headerText="Температура" style="text-align: center;">
                            <p:cellEditor disabled="#{!groundTempData.editable}">
                                <f:facet name="output">
                                    <h:outputText style="display: block;" value="#{groundTempData.value}" />
                                </f:facet>
                                <f:facet name="input">
                                    <p:inputNumber value="#{groundTempData.value}" emptyValue="0" />
                                </f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column width="40" style="text-align: center" rendered="#{systemParamsUtil.write}">
                            <p:rowEditor rendered="#{groundTempData.editable}" editTitle="Изменить строку"
                                         cancelTitle="Отменить изменения" saveTitle="Сохранить строку" />
                        </p:column>
                    </p:dataTable>
                </div>

                <f:facet name="actions">
                    <p:commandLink styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default tc-success tc-no-loading"
                                   action="#{groundTempMB.onAddNew()}" oncomplete="PF('groundTempTableWidget').filter(); showRowEdit();"
                                   rendered="#{systemParamsUtil.write}">
                        <h:outputText styleClass="ui-icon pi pi-plus-circle"/>
                    </p:commandLink>
                </f:facet>
            </p:panel>
        </div>
        <div style="height: 109px;">
            <p:panel styleClass="tc-panel" header="Эталонные значения температур">
                <div style="height: calc(100% - 6px); padding: 3px;">
                    <p:dataTable id="referenceValueTable" value="#{groundTempMB.referenceValues}" var="ref"
                                 editable="#{systemParamsUtil.write}" editMode="cell"
                                 emptyMessage="#{global['table.empty.value']}">

                        <p:ajax event="cellEdit" listener="#{groundTempMB.onCellEdit}" />

                        <p:column headerText="T3" style="text-align: center;">
                            <p:cellEditor disabled="#{!systemParamsUtil.write}">
                                <f:facet name="output">
                                    <h:outputText value="#{ref.t3}"/>
                                </f:facet>
                                <f:facet name="input">
                                    <p:inputNumber value="#{ref.t3}" decimalPlaces="2"/>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column headerText="T4" style="text-align: center;">
                            <p:cellEditor disabled="#{!systemParamsUtil.write}">
                                <f:facet name="output">
                                    <h:outputText value="#{ref.t4}"/>
                                </f:facet>
                                <f:facet name="input">
                                    <p:inputNumber value="#{ref.t4}" decimalPlaces="2"/>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column headerText="T7" style="text-align: center;">
                            <p:cellEditor disabled="#{!systemParamsUtil.write}">
                                <f:facet name="output">
                                    <h:outputText value="#{ref.t7}"/>
                                </f:facet>
                                <f:facet name="input">
                                    <p:inputNumber value="#{ref.t7}" decimalPlaces="2"/>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column headerText="T13" style="text-align: center;">
                            <p:cellEditor disabled="#{!systemParamsUtil.write}">
                                <f:facet name="output">
                                    <h:outputText value="#{ref.t13}"/>
                                </f:facet>
                                <f:facet name="input">
                                    <p:inputNumber value="#{ref.t13}" decimalPlaces="2"/>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column headerText="Tгр" style="text-align: center;">
                            <p:cellEditor disabled="#{!systemParamsUtil.write}">
                                <f:facet name="output">
                                    <h:outputText value="#{ref.tgr}"/>
                                </f:facet>
                                <f:facet name="input">
                                    <p:inputNumber value="#{ref.tgr}" decimalPlaces="2"/>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>
                    </p:dataTable>
                </div>

                <f:facet name="actions">
                    <p:commandLink styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default tc-success tc-no-loading tc-small"
                                   onclick="PF('statusDialog').show();" rendered="#{systemParamsUtil.write}"
                                   action="#{groundTempMB.onSaveChanges()}" update="referenceValueTable growl"
                                   oncomplete="PF('statusDialog').hide();">
                        <h:outputText styleClass="ui-icon pi pi-save"/>
                    </p:commandLink>
                </f:facet>
            </p:panel>
        </div>
    </h:form>
</ui:composition>

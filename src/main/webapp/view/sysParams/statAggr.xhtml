<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">

<h:body>
    <h:form id="statAggrForm" style="height: 100%;">
        <div style="display: flex; align-items: center; justify-content: space-between;
                border: 1px solid #c8c8c8; background-color: #f4f4f4; border-top-right-radius: 3px;
                border-top-left-radius: 3px; height: 41px;">
            <h:outputText style="font-weight: 700; margin-left: 15px; color: #333;" value="Статистические агрегаты"/>
            <div style="padding: 3px;">
                <p:commandButton id="btnRemove" icon="btnRemove" styleClass="iconOnlyButton btnLeft"
                                 disabled="#{statAggrMB.disableRemoveBtn}" action="#{statAggrMB.onRemoveTableParam}"
                                 onclick="PF('statusDialog').show();" oncomplete="PF('statusDialog').hide();"
                                 update="statAggrForm:statAggrTable statAggrForm:btnRemove"
                                 rendered="#{systemParamsUtil.write}" />
                <p:commandButton icon="btnAdd" styleClass="iconOnlyButton btnRight"
                                 update="statAggrForm:statAggrTable"
                                 onclick="PF('addNewParam').show();"
                                 rendered="#{systemParamsUtil.write}" />
            </div>
        </div>
        <div style="border: 1px solid #c8c8c8; height: calc(100% - 5px); padding: 3px;">
            <div style="height: 100%;">
                <p:dataTable id="statAggrTable" var="statAggrData" widgetVar="statAggrTable" value="#{statAggrMB.statsAggrTable}"
                             scrollable="true" scrollHeight="100%" emptyMessage="#{global['table.empty.value']}"
                             editable="#{systemParamsUtil.write}"
                             selectionMode="single" selection="#{statAggrMB.selectedPartInSATable}"
                             rowKey="#{statAggrData.id}">

                    <p:ajax event="rowSelect" listener="#{statAggrMB.onRowSelect}" update="statAggrForm:btnRemove" />

                    <p:column headerText="ID" style="width: 60px; white-space: nowrap">
                        <h:outputText style="display: block; text-align: center;" value="#{statAggrData.id}" />
                    </p:column>

                    <p:column headerText="Код статистического агрегата" width="200" style="white-space: nowrap">
                              <h:outputText style="display: block; width: 200px;" value="#{statAggrData.stat_agr_code}" />
                    </p:column>

                    <p:column headerText="Имя статистического агрегата" >
                        <h:outputText style="display: block;" value="#{statAggrData.stat_agr_name}" />
                    </p:column>
                    <p:column headerText="Дифференциал" style="width: 10px;">
                        <h:outputText style="display: block; text-align: center;" value="#{statAggrData.dif_int}" />
                    </p:column>
                </p:dataTable>
            </div>
        </div>
    </h:form>

    <p:dialog id="dialog" header="Добавление нового статистического агрегата" widgetVar="addNewParam" modal="true"
              resizable="false" rendered="#{systemParamsUtil.write}" >

        <p:ajax event="close" listener="#{statAggrMB.onAddStatAggrDialogClose}" update="statAGGrForm"/>

        <h:form id="statAGGrForm">
            <h:panelGrid columns="3" style="margin-bottom: 35px;">
                <p:outputLabel value="ID" for="@next"/>
                <p:inputNumber id="inputId" required="true" value="#{statAggrMB.addStatAggrTable.id}" minValue="-9999" maxValue="9999"
                               requiredMessage="#{global['validation.view.text']}"/>
                <p:message for="@previous"/>

                <p:outputLabel value="Код статистического агрегата" for="@next"/>
                <p:inputText required="true" value="#{statAggrMB.addStatAggrTable.stat_agr_code}"
                             requiredMessage="#{global['validation.view.text']}" style="width: 200px;"/>
                <p:message for="@previous" />

                <p:outputLabel value="Имя статистического агрегата" for="@next"/>
                <p:inputText required="true" value="#{statAggrMB.addStatAggrTable.stat_agr_name}"
                             requiredMessage="#{global['validation.view.text']}" style="width: 200px;"/>
                <p:message for="@previous" />

                <p:outputLabel value="Интегратор/дифференциатор " for="@next"/>
                <p:selectOneMenu id="params" style="width: 200px;" value="#{statAggrMB.addStatAggrTable.dif_int}">
                    <f:selectItem itemLabel="Интегратор" itemValue="I"/>
                    <f:selectItem itemLabel="Дифференциатор" itemValue="D"/>
                </p:selectOneMenu>
            </h:panelGrid>

            <p:commandButton value="Сохранить" id="btnSave" onclick="PF('statusDialog').show();" style="position: absolute; bottom: 5px; right: 95px;"
                             action="#{statAggrMB.onSaveChanges()}" validateClient="true"
                             oncomplete="PF('statusDialog').hide();" update="statAggrForm:statAggrTable statAGGrForm"/>

            <p:commandButton value="Отмена" id="btnCanc" oncomplete="PF('addNewParam').hide();"
                             styleClass="ui-button-secondary" style="position: absolute; bottom: 5px; right: 5px;"/>
        </h:form>
    </p:dialog>
</h:body>
</ui:composition>
